{% extends 'base.html' %}
{% load i18n %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        
        <div class="col-md-8">
            
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-primary text-white">
                    {% trans "–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" %}
                </div>
                <div class="card-body">
                    <h4 class="card-title">{{ user.username }}</h4>
                    <p class="card-text text-muted">Email: {{ user.email }}</p>
                    
                    <p class="card-text">
                        {% trans "–¢–µ–∫—É—â–∏–π IQ" %}: 
                        <strong>{{ user.iq_score|default:"–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω" }}</strong>
                    </p>

                    <div class="mt-3 border-top pt-3">
                        <a href="{% url 'edit_profile' %}" class="btn btn-outline-primary btn-sm me-2">
                            {% trans "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ" %}
                        </a>
                        <a href="{% url 'password_change' %}" class="btn btn-outline-warning btn-sm">
                            {% trans "–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å" %}
                        </a>
                    </div>
                </div>
            </div>

            <div class="alert alert-info shadow-sm">
                {% if user.telegram_chat_id %}
                    <strong class="text-success">‚úÖ Telegram –ø–æ–¥–∫–ª—é—á–µ–Ω!</strong>
                    <p class="mb-0 small">–í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –±–æ—Ç.</p>
                {% else %}
                    <h5>üöÄ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Telegram</h5>
                    <p>–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:</p>
                    <ol class="mb-2">
                        <li>–ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞ <strong>@iq120Plus_bot</strong></li>
                        <li>–ù–∞–∂–º–∏—Ç–µ <b>Start</b></li>
                        <li>–û—Ç–ø—Ä–∞–≤—å—Ç–µ –µ–º—É –∫–æ–º–∞–Ω–¥—É:</li>
                    </ol>
                    <div class="bg-white p-2 rounded text-center border">
                        <h4 class="m-0 text-primary">/start {{ user.telegram_code }}</h4>
                    </div>
                {% endif %}
            </div>

            <div class="card shadow-sm mt-4">
                <div class="card-header">
                    {% trans "–ò—Å—Ç–æ—Ä–∏—è —Ç–µ—Å—Ç–æ–≤" %}
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover table-striped mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>{% trans "–¢–µ—Å—Ç" %}</th>
                                    <th>{% trans "–ë–∞–ª–ª—ã" %}</th>
                                    <th>{% trans "–î–∞—Ç–∞" %}</th>
                                    <th>{% trans "–î–µ—Ç–∞–ª–∏" %}</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for res in results %}
                                <tr>
                                    <td>{{ res.test.title }}</td>
                                    <td>
                                        <span class="badge bg-primary rounded-pill">{{ res.score }}</span>
                                    </td>
                                    <td>{{ res.date_taken|date:"d.m.Y H:i" }}</td>
                                    <td>
                                        <a href="{% url 'result_detail' res.id %}" class="btn btn-sm btn-outline-info">
                                            üëÅÔ∏è {% trans "–û—Ç—á–µ—Ç" %}
                                        </a>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="4" class="text-center text-muted py-4">
                                        {% trans "–í—ã –µ—â–µ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ —Ç–µ—Å—Ç—ã." %}
                                        <br>
                                        <a href="{% url 'home' %}" class="btn btn-sm btn-success mt-2">–ü–µ—Ä–µ–π—Ç–∏ –∫ —Ç–µ—Å—Ç–∞–º</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card shadow border-warning mb-4">
                <div class="card-header bg-warning text-dark fw-bold">
                    ‚≠ê {% trans "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–æ–π" %}
                </div>
                <div class="card-body text-center">
                    <p class="text-muted mb-1">{% trans "–í–∞—à —Ç–µ–∫—É—â–∏–π —Ç–∞—Ä–∏—Ñ:" %}</p>
                    
                    <h2 class="text-uppercase text-primary mb-3">
                        {{ user.profile.get_plan_display }}
                    </h2>
                    
                    <hr>
                    
                    <p class="small text-muted">
                        {% trans "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ (–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º):" %}
                    </p>
                    
                    <div class="d-grid gap-2">
                        <a href="{% url 'upgrade_profile' 'free' %}?next={% url 'profile' %}" 
                           class="btn btn-outline-secondary {% if user.profile.plan == 'free' %}active{% endif %}">
                            Free (1 —Ç–µ—Å—Ç)
                        </a>

                        <a href="{% url 'upgrade_profile' 'pro' %}?next={% url 'profile' %}" 
                           class="btn btn-success {% if user.profile.plan == 'pro' %}disabled{% endif %}">
                            Pro (–í—Å–µ —Ç–µ—Å—Ç—ã) üöÄ
                        </a>

                        <a href="{% url 'upgrade_profile' 'hr' %}?next={% url 'profile' %}" 
                           class="btn btn-warning text-dark {% if user.profile.plan == 'hr' %}disabled{% endif %}">
                            HR (–†–µ–∫—Ä—É—Ç–µ—Ä) üíº
                        </a>
                    </div>
                    
                    <div class="mt-3 small text-muted fst-italic">
                        * {% trans "–í –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ –æ–ø–ª–∞—Ç–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è —Å–º–µ–Ω—ã —Å—Ç–∞—Ç—É—Å–∞." %}
                    </div>
                </div>
            </div>
            
            <div class="card shadow-sm">
                <div class="card-body">
                    <h6>üí° {% trans "–ó–Ω–∞–µ—Ç–µ –ª–∏ –≤—ã?" %}</h6>
                    <p class="small text-muted mb-0">
                        {% trans "–ü–æ–¥–ø–∏—Å–∫–∞ Pro –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ—Å–¥–∞–≤–∞—Ç—å —Ç–µ—Å—Ç—ã –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞." %}
                    </p>
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock %}