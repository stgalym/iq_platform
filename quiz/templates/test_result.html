{% extends 'base.html' %}
{% load i18n %}

{% block content %}
<div class="container">
    <div class="text-center mb-5">
        <h1 class="display-5">{% trans "–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è" %}</h1>
        <h2>{{ test.title }}</h2>
        <h3 class="mt-3">
            {% trans "–í–∞—à —Å—á–µ—Ç:" %} 
            <span class="badge bg-success">{{ score }} / {{ total }}</span>
        </h3>
    </div>

    {% if ai_analysis %}
        <div class="card border-info mb-5 shadow-sm">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">ü§ñ {% trans "–ê–Ω–∞–ª–∏–∑ –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞" %}</h5>
            </div>
            <div class="card-body">
                <p class="card-text" style="white-space: pre-line; font-size: 1.1em;">{{ ai_analysis }}</p>
            </div>
        </div>
    {% endif %}

    {% if user_answers %}
        <h4 class="mb-3">{% trans "–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä:" %}</h4>
        <div class="table-responsive">
            <table class="table table-bordered">
                <thead class="table-light">
                    <tr>
                        <th>#</th>
                        <th>{% trans "–í–æ–ø—Ä–æ—Å" %}</th>
                        <th>{% trans "–í–∞—à –æ—Ç–≤–µ—Ç" %}</th>
                        <th>{% trans "–°—Ç–∞—Ç—É—Å" %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in user_answers %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>
                            {{ item.question.text }}
                            {% if item.question.image %}
                                <br><small class="text-muted">({% trans "—Å –∫–∞—Ä—Ç–∏–Ω–∫–æ–π" %})</small>
                            {% endif %}
                        </td>
                        <td>
                            {% if item.selected_answer %}
                                {{ item.selected_answer.text }}
                            {% else %}
                                <em class="text-muted">{% trans "–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞" %}</em>
                            {% endif %}
                        </td>
                        <td>
                            {% if item.is_correct %}
                                <span class="text-success">‚úÖ {% trans "–í–µ—Ä–Ω–æ" %}</span>
                            {% else %}
                                <span class="text-danger">‚ùå {% trans "–û—à–∏–±–∫–∞" %}</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}

    <div class="text-center mt-4 mb-5">
        <a href="{% url 'profile' %}" class="btn btn-primary btn-lg">{% trans "–í –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç" %}</a>
        <a href="{% url 'home' %}" class="btn btn-outline-secondary btn-lg">{% trans "–ö —Å–ø–∏—Å–∫—É —Ç–µ—Å—Ç–æ–≤" %}</a>
    </div>
</div>
{% endblock %}